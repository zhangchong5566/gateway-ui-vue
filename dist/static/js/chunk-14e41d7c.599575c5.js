(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-14e41d7c"],{"3d3e":function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{rules:e.rules,model:e.tempItem,"label-width":"150px"}},[r("el-form-item",{attrs:{label:"集群",prop:"bindClusterId"}},[e.isShow?r("span",[e._v(e._s(e.tempItem.bindClusterName))]):[r("el-select",{model:{value:e.tempItem.bindClusterId,callback:function(t){e.$set(e.tempItem,"bindClusterId",t)},expression:"tempItem.bindClusterId"}},e._l(e.clustersList,(function(e,t){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]],2),e._v(" "),r("el-form-item",{attrs:{label:"地址",prop:"addr"}},["show"==e.showType?r("span",[e._v(e._s(e.tempItem.addr))]):r("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:'"IP:PORT",默认80端口'},model:{value:e.tempItem.addr,callback:function(t){e.$set(e.tempItem,"addr",t)},expression:"tempItem.addr"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"接口协议"}},[e.isShow?r("span",[e._v(e._s(e._f("protocolFilter")(e.tempItem.protocol)))]):[r("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"Server的接口协议"},model:{value:e.tempItem.protocol,callback:function(t){e.$set(e.tempItem,"protocol",t)},expression:"tempItem.protocol"}},e._l(e.protocolConstant,(function(e){return r("el-option",{key:e.value,attrs:{value:e.value,label:e.title}})})),1)]],2),e._v(" "),r("el-form-item",{attrs:{label:"支持的最大QPS",prop:"maxQPS"}},["show"==e.showType?r("span",[e._v(e._s(e.tempItem.maxQPS))]):r("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"用于流控"},model:{value:e.tempItem.maxQPS,callback:function(t){e.$set(e.tempItem,"maxQPS",e._n(t))},expression:"tempItem.maxQPS"}})],1),e._v(" "),r("el-form-item",{staticStyle:{width:"800px"},attrs:{label:"健康检查机制"}},[r("el-row",{directives:[{name:"show",rawName:"v-show",value:e.needHeathCheck,expression:"needHeathCheck"}]},[r("el-col",[r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"clearfix",staticStyle:{"line-height":"25px"},attrs:{slot:"header"},slot:"header"},[r("el-alert",{attrs:{closable:!1,title:"Server的健康检查机制，目前支持HTTP的协议检查，支持检查返回状态码以及返回内容。如果没有设置，认为这个Server的健康检查交给外部，Gateway永久认为这个Server是健康的。",type:"warning"}})],1),e._v(" "),r("el-row",[r("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:5}},[r("span",{staticClass:"red-icon"},[e._v("*")]),e._v(" 检查路径:\n                            ")]),e._v(" "),r("el-col",{attrs:{span:10}},[e.isShow?r("span",[e._v(e._s(e.tempItem.heathCheck.path))]):r("el-input",{attrs:{placeholder:"检测路径，如/ping"},model:{value:e.tempItem.heathCheck.path,callback:function(t){e.$set(e.tempItem.heathCheck,"path",t)},expression:"tempItem.heathCheck.path"}})],1)],1),e._v(" "),r("el-row",{staticClass:"el-margin-top"},[r("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:5}},[r("span",{staticClass:"red-icon"},[e._v("*")]),e._v("检测间隔时间:\n                            ")]),e._v(" "),r("el-col",{attrs:{span:10}},[e.isShow?r("span",[e._v(e._s(e._f("toSecondFilter")(e.tempItem.heathCheck.checkInterval)))]):r("el-input",{attrs:{placeholder:"请填写"},model:{value:e.tempItem.heathCheck.checkInterval,callback:function(t){e.$set(e.tempItem.heathCheck,"checkInterval",e._n(t))},expression:"tempItem.heathCheck.checkInterval"}},[r("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.tempItem.heathCheck.checkIntervalType,callback:function(t){e.$set(e.tempItem.heathCheck,"checkIntervalType",t)},expression:"tempItem.heathCheck.checkIntervalType"}},e._l(e.timeTypeConstant,(function(e){return r("el-option",{key:e.value,attrs:{value:e.value,label:e.title}})})),1)],1)],1)],1),e._v(" "),r("el-row",{staticClass:"el-margin-top"},[r("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:5}},[r("span",{staticClass:"red-icon"},[e._v("*")]),e._v("检测超时时间:\n                            ")]),e._v(" "),r("el-col",{attrs:{span:10}},[e.isShow?r("span",[e._v(e._s(e._f("toSecondFilter")(e.tempItem.heathCheck.timeout)))]):r("el-input",{attrs:{placeholder:"请填写"},model:{value:e.tempItem.heathCheck.timeout,callback:function(t){e.$set(e.tempItem.heathCheck,"timeout",e._n(t))},expression:"tempItem.heathCheck.timeout"}},[r("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.tempItem.heathCheck.timeoutType,callback:function(t){e.$set(e.tempItem.heathCheck,"timeoutType",t)},expression:"tempItem.heathCheck.timeoutType"}},e._l(e.timeTypeConstant,(function(e){return r("el-option",{key:e.value,attrs:{value:e.value,label:e.title}})})),1)],1)],1)],1),e._v(" "),r("el-row",{staticClass:"el-margin-top"},[r("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:5}},[e._v("返回内容:\n                            ")]),e._v(" "),r("el-col",{attrs:{span:10}},[e.isShow?r("span",[e._v(e._s(e.tempItem.heathCheck.body))]):r("el-input",{attrs:{placeholder:"返回内容",type:"textarea"},model:{value:e.tempItem.heathCheck.body,callback:function(t){e.$set(e.tempItem.heathCheck,"body",t)},expression:"tempItem.heathCheck.body"}})],1)],1)],1),e._v(" "),e.isShow?e._e():r("el-button",{attrs:{type:"text"},on:{click:function(t){e.needHeathCheck=!1}}},[e._v("移除健康检查机制")])],1)],1),e._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.needHeathCheck,expression:"!needHeathCheck"}],attrs:{type:"text"},on:{click:function(t){e.needHeathCheck=!0}}},[e._v("添加健康检查机制\n            ")])],1),e._v(" "),r("el-form-item",{staticStyle:{width:"800px"},attrs:{label:"熔断器设置"}},[r("el-row",{directives:[{name:"show",rawName:"v-show",value:e.needCircuitBreaker,expression:"needCircuitBreaker"}]},[r("el-col",[r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"clearfix",staticStyle:{"line-height":"25px"},attrs:{slot:"header"},slot:"header"},[r("el-alert",{attrs:{closable:!1,title:"熔断器，设置后端Server的熔断规则。熔断器分为3个状态： Open、Half、Close",type:"warning"}})],1),e._v(" "),r("el-row",[r("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:8}},[r("span",{staticClass:"red-icon"},[e._v("*")]),e._v("关闭检查间隔时间:\n                            ")]),e._v(" "),r("el-col",{attrs:{span:10}},[e.isShow?r("span",[e._v(e._s(e._f("toSecondFilter")(e.tempItem.circuitBreaker.closeTimeout)))]):r("el-input",{attrs:{placeholder:"请填写"},model:{value:e.tempItem.circuitBreaker.closeTimeout,callback:function(t){e.$set(e.tempItem.circuitBreaker,"closeTimeout",e._n(t))},expression:"tempItem.circuitBreaker.closeTimeout"}},[r("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.tempItem.circuitBreaker.closeTimeoutType,callback:function(t){e.$set(e.tempItem.circuitBreaker,"closeTimeoutType",t)},expression:"tempItem.circuitBreaker.closeTimeoutType"}},e._l(e.timeTypeConstant,(function(e){return r("el-option",{key:e.value,attrs:{value:e.value,label:e.title}})})),1)],1)],1)],1),e._v(" "),r("el-row",{staticClass:"el-margin-top"},[r("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:8}},[r("span",{staticClass:"red-icon"},[e._v("*")]),e._v("熔断器检查周期:\n                            ")]),e._v(" "),r("el-col",{attrs:{span:10}},[e.isShow?r("span",[e._v(e._s(e._f("toSecondFilter")(e.tempItem.circuitBreaker.rateCheckPeriod)))]):r("el-input",{attrs:{placeholder:"请填写"},model:{value:e.tempItem.circuitBreaker.rateCheckPeriod,callback:function(t){e.$set(e.tempItem.circuitBreaker,"rateCheckPeriod",e._n(t))},expression:"tempItem.circuitBreaker.rateCheckPeriod "}},[r("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.tempItem.circuitBreaker.rateCheckPeriodType,callback:function(t){e.$set(e.tempItem.circuitBreaker,"rateCheckPeriodType",t)},expression:"tempItem.circuitBreaker.rateCheckPeriodType"}},e._l(e.timeTypeConstant,(function(e){return r("el-option",{key:e.value,attrs:{value:e.value,label:e.title}})})),1)],1)],1)],1),e._v(" "),r("el-row",{staticClass:"el-margin-top"},[r("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:8}},[r("span",{staticClass:"red-icon"},[e._v("*")]),e._v("Half限流百分比:\n                            ")]),e._v(" "),r("el-col",{attrs:{span:10}},[e.isShow?r("span",[e._v(e._s(e.tempItem.circuitBreaker.halfTrafficRate))]):r("el-input",{attrs:{placeholder:"区间：1-100"},model:{value:e.tempItem.circuitBreaker.halfTrafficRate,callback:function(t){e.$set(e.tempItem.circuitBreaker,"halfTrafficRate",e._n(t))},expression:"tempItem.circuitBreaker.halfTrafficRate"}})],1)],1),e._v(" "),r("el-row",{staticClass:"el-margin-top"},[r("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:8}},[r("span",{staticClass:"red-icon"},[e._v("*")]),e._v("Open -> Close的错误百分比:\n                            ")]),e._v(" "),r("el-col",{attrs:{span:10}},[e.isShow?r("span",[e._v(e._s(e.tempItem.circuitBreaker.failureRateToClose))]):r("el-input",{attrs:{placeholder:"区间：1-100"},model:{value:e.tempItem.circuitBreaker.failureRateToClose,callback:function(t){e.$set(e.tempItem.circuitBreaker,"failureRateToClose",e._n(t))},expression:"tempItem.circuitBreaker.failureRateToClose"}})],1)],1),e._v(" "),r("el-row",{staticClass:"el-margin-top"},[r("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:8}},[r("span",{staticClass:"red-icon"},[e._v("*")]),e._v("Half -> Open的成功百分比:\n                            ")]),e._v(" "),r("el-col",{attrs:{span:10}},[e.isShow?r("span",[e._v(e._s(e.tempItem.circuitBreaker.succeedRateToOpen))]):r("el-input",{attrs:{placeholder:"区间：1-100"},model:{value:e.tempItem.circuitBreaker.succeedRateToOpen,callback:function(t){e.$set(e.tempItem.circuitBreaker,"succeedRateToOpen",e._n(t))},expression:"tempItem.circuitBreaker.succeedRateToOpen"}})],1)],1)],1),e._v(" "),e.isShow?e._e():r("el-button",{attrs:{type:"text"},on:{click:function(t){e.needCircuitBreaker=!1}}},[e._v("移除熔断规则")])],1)],1),e._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.needCircuitBreaker,expression:"!needCircuitBreaker"}],attrs:{type:"text"},on:{click:function(t){e.needCircuitBreaker=!0}}},[e._v("添加熔断规则\n            ")])],1),e._v(" "),r("div",{staticStyle:{"margin-left":"70px"}},[r("el-button",{on:{click:e.goList}},[e._v("返回")]),e._v(" "),"show"==e.showType?r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.goEdit("dataForm")}}},[e._v("编辑")]):"create"==e.showType?r("el-button",{attrs:{loading:e.submitting,type:"primary"},on:{click:function(t){return e.createItem("dataForm")}}},[e._v("添加\n            ")]):"update"==e.showType?r("el-button",{attrs:{loading:e.submitting,type:"primary"},on:{click:function(t){return e.updateItem("dataForm")}}},[e._v("修改\n            ")]):e._e()],1)],1)],1)},i=[],c=(r("a481"),r("7f7f"),r("2435")),s=r("aa22"),n=r("7ea2"),o=r("fdfe"),l=r("ed08");function u(){return{id:void 0,addr:"",protocol:c["p"].http,maxQPS:void 0,heathCheck:{path:"",body:"",checkInterval:0,checkIntervalType:c["y"].second,timeout:0,timeoutType:c["y"].second},circuitBreaker:{closeTimeout:0,closeTimeoutType:c["y"].second,rateCheckPeriod:0,rateCheckPeriodType:c["y"].second,halfTrafficRate:"",failureRateToClose:"",succeedRateToOpen:""},bindClusterId:"",bindClusterName:""}}var h={name:"serverForm",props:{showType:{type:String,default:c["d"].create},editItem:{type:Object}},data:function(){return{loading:!0,submitting:!1,circuitBreakerConstant:c["a"],protocolConstant:c["o"],timeTypeConstant:c["w"],rules:{bindClusterId:[{required:!0,message:"请选择集群",trigger:"change"}],addr:[{required:!0,message:"请填写地址",trigger:"change"},{min:5,max:255,message:"长度请控制在 5 - 255",trigger:"change"}],maxQPS:[{required:!0,message:"请填写支持的最大QPS",trigger:"change"},{type:"number",min:1,message:"数值必须大于0",trigger:"change"}]},tempItem:u(),clustersList:[],needHeathCheck:!1,needCircuitBreaker:!1}},computed:{isShow:function(){return this._isShow()},isCreate:function(){return this._isCreate()},isUpdate:function(){return this._isUpdate()}},created:function(){this.init()},watch:{editItem:function(e,t){var r=Object(l["d"])(u(),Object(l["a"])(e));this._isShow()||(r.heathCheck.path&&(this.needHeathCheck=!0),r.circuitBreaker.halfTrafficRate&&(this.needCircuitBreaker=!0),r.heathCheck.checkInterval&&(r.heathCheck.checkInterval=Object(l["k"])(r.heathCheck.checkInterval)),r.heathCheck.timeout&&(r.heathCheck.timeout=Object(l["k"])(r.heathCheck.timeout)),r.circuitBreaker.closeTimeout&&(r.circuitBreaker.closeTimeout=Object(l["k"])(r.circuitBreaker.closeTimeout)),r.circuitBreaker.rateCheckPeriod&&(r.circuitBreaker.rateCheckPeriod=Object(l["k"])(r.circuitBreaker.rateCheckPeriod)),r.heathCheck.checkIntervalType=c["y"].second,r.heathCheck.timeoutType=c["y"].second,r.circuitBreaker.closeTimeoutType=c["y"].second,r.circuitBreaker.rateCheckPeriodType=c["y"].second),this.tempItem=r,this.loading=!1,this.submitting=!1}},methods:{init:function(){var e=this;this._isShow()?(this.rules={},this.needHeathCheck=!0,this.needCircuitBreaker=!0):this._isCreate()&&(this.loading=!1,this.tempItem=Object(l["d"])(this.tempItem,Object(l["a"])(this.editItem))),n["b"]().then((function(t){e.clustersList=t||[],e._isShow()&&e.initShow()}))},initShow:function(){if(this.tempItem.bindClusterId)for(var e=0,t=this.clustersList.length;e<t;e++){var r=this.clustersList[e];r.id==this.tempItem.bindClusterId&&(this.tempItem.bindClusterName=r.name)}},goList:function(){this.$router.replace({path:"/server",query:{id:this.tempItem.bindClusterId}}),this.$destroy()},goEdit:function(){this.$router.push({path:"/server/edit",query:{id:this.tempItem.id,clusterId:this.tempItem.bindClusterId}}),this.$destroy()},createItem:function(e){var t=this;this.submitting||this.$refs[e].validate((function(e){if(!e)return!1;t._doCreateItem()}))},_doCreateItem:function(){var e=this,t=this._formatFormData();t&&(this.submitting=!0,s["c"](t).then((function(t){var r={clusterID:e.tempItem.bindClusterId,serverID:t};o["b"](r).then((function(){e.$message({type:"success",message:"创建成功!"}),setTimeout((function(){e.goList()}),2e3)})).catch((function(){e.submitting=!0}))})))},updateItem:function(e){var t=this;this.submitting||this.$refs[e].validate((function(e){if(!e)return!1;t._doUpdateItem()}))},_doUpdateItem:function(){var e=this,t=this._formatFormData();t&&(this.submitting=!0,s["c"](t).then((function(t){var r={clusterID:e.tempItem.bindClusterId,serverID:t};o["b"](r).then((function(){e.$message({type:"success",message:"修改成功!"}),setTimeout((function(){e.goList()}),2e3)})).catch((function(){e.submitting=!1}))})))},_formatFormData:function(){var e=Object(l["a"])(this.tempItem);if(e.id||delete e.id,e.addr&&(e.addr=e.addr.replace("：",":"),-1===e.addr.indexOf(":")&&(e.addr=e.addr+":80")),e.heathCheck.timeout=Object(l["j"])(e.heathCheck.timeout,e.heathCheck.timeoutType),e.heathCheck.checkInterval=Object(l["j"])(e.heathCheck.checkInterval,e.heathCheck.checkIntervalType),e.circuitBreaker.rateCheckPeriod=Object(l["j"])(e.circuitBreaker.rateCheckPeriod,e.circuitBreaker.rateCheckPeriodType),e.circuitBreaker.closeTimeout=Object(l["j"])(e.circuitBreaker.closeTimeout,e.circuitBreaker.closeTimeoutType),this.needHeathCheck){if(!e.heathCheck.path)return this._showMessage("填写健康检查机制的检查路径字段"),!1;if(!e.heathCheck.checkInterval)return this._showMessage("填写健康检查机制的间隔时间字段"),!1;if(!e.heathCheck.timeout)return this._showMessage("填写健康检查机制的超时时间字段"),!1}else delete e.heathCheck;if(this.needCircuitBreaker){if(!e.circuitBreaker.closeTimeout)return this._showMessage("填写熔断规则的间隔时间字段"),!1;if(!e.circuitBreaker.rateCheckPeriod)return this._showMessage("填写熔断规则的检查周期字段"),!1;if(!e.circuitBreaker.halfTrafficRate)return this._showMessage("填写熔断规则的Half限流百分比字段"),!1;if(!e.circuitBreaker.failureRateToClose)return this._showMessage("填写熔断规则的Open -> Close的错误百分比字段"),!1;if(!e.circuitBreaker.succeedRateToOpen)return this._showMessage("填写熔断规则的Half -> Open的成功百分比字段"),!1}else delete e.circuitBreaker;return e},_showMessage:function(e){this.$message({type:"warning",message:e})},_isUpdate:function(){return this.showType===c["d"].update},_isShow:function(){return this.showType===c["d"].show},_isCreate:function(){return this.showType===c["d"].create}}},p=h,m=(r("52c8"),r("2877")),d=Object(m["a"])(p,a,i,!1,null,"5512679e",null);t["a"]=d.exports},"52c8":function(e,t,r){"use strict";var a=r("ca27"),i=r.n(a);i.a},"7ea2":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return l})),r.d(t,"a",(function(){return u})),r.d(t,"c",(function(){return h}));var a=r("b775"),i=r("2435"),c="/clusters";function s(e){return Object(a["a"])({url:c,method:"GET",params:e})}function n(){return new Promise((function(e,t){var r=[],a="",c=i["c"];function n(i){s(i).then((function(t){t=t||[];var i=t.length;if(i>0){if(r=r.concat(t),a=t[i-1]||{},a.id){var s={after:a.id,limit:c};n(s)}}else e(r)})).catch((function(){t()}))}var o={after:"",limit:c};n(o)}))}function o(e){return Object(a["a"])({url:c+"/"+e,method:"GET"})}function l(e){return Object(a["a"])({url:c,method:"PUT",data:e})}function u(e){return Object(a["a"])({url:c+"/"+e,method:"DELETE"})}function h(e){return Object(a["a"])({url:c+"/"+e+"/binds",method:"GET"})}},aa22:function(e,t,r){"use strict";r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return s})),r.d(t,"a",(function(){return n}));var a=r("b775"),i=(r("2435"),"/servers");function c(e){return Object(a["a"])({url:i+"/"+e,method:"GET"})}function s(e){return Object(a["a"])({url:i,method:"PUT",data:e})}function n(e){return Object(a["a"])({url:i+"/"+e,method:"DELETE"})}},b775:function(e,t,r){"use strict";var a=r("bc3a"),i=r.n(a),c=r("5c96"),s="",n="",o=n+"/v1",l=i.a.create({baseURL:s+o,timeout:6e4});l.interceptors.request.use((function(e){return e}),(function(e){console.error(e),Promise.reject(e)})),l.interceptors.response.use((function(e){var t=e.data||{};e.headers;return 0===t.code?t.data:(Object(c["Message"])({message:t.data,type:"error",duration:5e3}),Promise.reject("error"))}),(function(e){return Object(c["Message"])({message:e.data||"网络异常",type:"error",duration:5e3}),Promise.reject(e)})),t["a"]=l},ca27:function(e,t,r){},fdfe:function(e,t,r){"use strict";r.d(t,"b",(function(){return c})),r.d(t,"a",(function(){return s}));var a=r("b775"),i="/binds";function c(e){return Object(a["a"])({url:i,method:"PUT",data:e})}function s(e){return Object(a["a"])({url:i,method:"DELETE",data:e})}}}]);